<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Amqp en - MSC Open Data / Données ouvertes du SMC</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <link href="../../css/extra.css" rel="stylesheet">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">MSC Open Data / <br>Données ouvertes du SMC</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../../msc-data/readme_en/" class="nav-link">Available data /<br>Données disponibles</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Data access /<br>Accès aux données <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../msc-geomet/readme_en/" class="dropdown-item">MSC GeoMet /<br>GeoMet du SMC</a>
</li>
                                    
<li>
    <a href="../readme_en/" class="dropdown-item">MSC Datamart /<br>Datamart du SMC</a>
</li>
                                    
<li>
    <a href="../../cost-recovered/readme_en/" class="dropdown-item">Cost-recovered services /<br>Services à recouvrement de coûts</a>
</li>
                                    
<li>
    <a href="../../msc-animet/readme_en/" class="dropdown-item">MSC AniMet /<br>AniMet du SMC</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Usage and tutorials / <br>Utilisation et tutoriels <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../usage/readme_en/" class="dropdown-item">Usage overview/<br>Aperçu de l'utilisation</a>
</li>
                                    
<li>
    <a href="../../usage/tutorials_en/" class="dropdown-item">Access tutorials /<br>Accéder aux tutoriels</a>
</li>
                                    
<li>
    <a href="../../msc-geomet/wms_en/" class="dropdown-item">WMS technical doc /<br>Doc technique du WMS</a>
</li>
                                    
<li>
    <a href="../../msc-geomet/wcs_en/" class="dropdown-item">WCS technical doc /<br>Doc technique du WCS</a>
</li>
                                    
<li>
    <a href="../../msc-geomet/ogc_api_en/" class="dropdown-item">OGC API technical doc /<br>Doc technique de l'OGC API</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="https://weather.gc.ca/mainmenu/contact_us_e.html" class="nav-link">Contact us /<br>Contactez-nous</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search /<br> <i class="fa fa-fw"></i>Rechercher
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#advanced-message-queuing-protocol" class="nav-link">Advanced Message Queuing Protocol</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#about" class="nav-link">About</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#description" class="nav-link">Description</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#windows-environment" class="nav-link">Windows environment</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#examples" class="nav-link">Examples</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#external-links" class="nav-link">External links</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#contact-us" class="nav-link">Contact Us</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<p><a href="../amqp_fr/">En français</a></p>
<p><img alt="ECCC logo" src="../../img_eccc-logo.png" /></p>
<p><a href="../../readme_en/">TOC</a> &gt; <a href="../readme_en/">MSC Datamart</a> &gt; AMQP</p>
<h1 id="advanced-message-queuing-protocol">Advanced Message Queuing Protocol</h1>
<h2 id="about">About</h2>
<p>The HTTPS raw data server called 'MSC Datamart' is a real-time on-demand download service.  The user must, in effect, act to retrieve particular data, and the request will only be successful if the data was previously published on the server.  </p>
<p>The exact time of publication of the data on the MSC Datamart is more or less predictable: a new weather warning can appear at any time, while other data are produced on a fairly regular schedule (but still subject to occasional interruptions).  However, it may be important for some applications that data is obtained as soon as it is published.   </p>
<p>Attempts to obtain MSC Datamart data as soon as they appear on the server generate numerous premature queries that are obviously unsuccessful. This motivates the use of a more elegant and convenient solution for users.    </p>
<p>To facilitate the retrieval of timely data on the MSC Datamart, the Meteorological Service of Canada (MSC) has set up a data wire for announcing file availability on the MSC Datamart.  This data wire uses the 'Advanced Message Queuing Protocol' (AMQP) protocol, making it  possible not only to be notified of the availability of products on the MSC Datamart as they are published, but also to receive them automatically. </p>
<p>The service permits targeting notifications for a specific set of files (weather warnings, observations, data model, etc.) and thus notification for only those products of interest to the user.</p>
<p>A sample script using this protocol is made available by Environment and Climate Change Canada.  See "Script" section below.</p>
<h2 id="description">Description</h2>
<p>The script uses the python language (<a href="https://www.python.org/">https://www.python.org/</a>) and must be installed on the system where it will be run.  Moreover, the python-amqp library must also be installed.  Please read the documentation specific to your operating system for instructions on installing the software and this library.</p>
<p>The SSL (Secure Sockets Layers) AMQP server is located at this address: dd.weather.gc.ca</p>
<p>It is possible to connect anonymously using the following credentials:</p>
<ul>
<li><strong>User name</strong>: anonymous</li>
<li><strong>Password</strong>: anonymous </li>
</ul>
<h3 id="path">Path</h3>
<p>For the subtopic, one only needs to  write the directory where the product is found, replacing the slash "/" with a dot ".".</p>
<p>This subtopic is: PRODUCT.DIRECTORY.ON.THE.DATAMART</p>
<ul>
<li>'__<em>__'  character is a wildcard (only one '</em>' per directory)</li>
<li>'<strong>#</strong>'  means all remaining possibilities and must appear at the end of the key.</li>
</ul>
<h3 id="script">Script</h3>
<p>The script allowing to recover products on the MSC Datamart and to place them in a local directory chosen by the user uses the client Sarracenia (Subscribe And Recursively Re-advertise Ad nauseam to Communicate Everything Nearly Instantly and Always).</p>
<p>This client is designed to perform downloads in a very reliable manner and is widely used within the Government of Canada:</p>
<p><a href="https://metpx.github.io/sarracenia/">https://metpx.github.io/sarracenia/</a></p>
<p>An overview is available here: <a href="https://metpx.github.io/sarracenia/Explanation/Overview.html">https://metpx.github.io/sarracenia/Explanation/Overview.html</a></p>
<p>The installation guide can be found at this address :
<a href="https://metpx.github.io/sarracenia/Tutorials/Install.html">https://metpx.github.io/sarracenia/Tutorials/Install.html</a></p>
<p>Regarding the user guide, please consult : 
<a href="https://metpx.github.io/sarracenia/How2Guides/subscriber.html">https://metpx.github.io/sarracenia/How2Guides/subscriber.html</a></p>
<p>Several examples of configuration files are also available to users, see:
<a href="https://github.com/MetPX/sarracenia/tree/main/sarracenia/examples/subscribe">https://github.com/MetPX/sarracenia/tree/main/sarracenia/examples/subscribe</a></p>
<p><strong>NOTE</strong>:</p>
<p>To <strong>facilitate support</strong>, our analysts suggest that users identify themselves, in order to more easily track down queues in case of problems. It is therefore highly recommended to add one of the following lines in the sr_subscribe configuration:</p>
<ul>
<li>queue_name q_${BROKER_USER}.${PROGRAM}.${CONFIG}.${HOSTNAME} (dynamic option)</li>
<li>q_anonymous.sr_subscribe.config_name.company_name (static option)</li>
</ul>
<p>Example: q_anonymous.sr_subscribe.citypage.companyX</p>
<p>Also, here is a list of recommendations for the "anonymous" user who wishes to retrieve a significant subset of data without fear of losing information:</p>
<ul>
<li>The <code>expire</code> option reflects the user's desired retention period. We suggest a value greater than 5 minutes, which is the default.  </li>
<li>Increase the number of instances in the configuration which allows for more efficient processing of messages to minimize their number in the queue.</li>
<li>Split the configurations into several smaller configurations to avoid reaching the maximum of 10,000 messages in a queue (the name of the queues must be different between the configurations)</li>
</ul>
<h2 id="windows-environment">Windows environment</h2>
<p>Working with the Windows environment, simply download the latest version of Sarracenia at this address:</p>
<p><a href="https://hpfx.collab.science.gc.ca/~pas037/Sarracenia_Releases/">https://hpfx.collab.science.gc.ca/~pas037/Sarracenia_Releases/</a></p>
<p>This is an EXE file that can be used without having to <a href="https://github.com/MetPX/sarracenia/blob/master/doc/fr/Install.rst">install</a> a Python environment.</p>
<h2 id="examples">Examples</h2>
<p>Here are some specific examples to receive alerts, citypage_weather data for one city and RDPS GRIB parameters:</p>
<ul>
<li>The available commands are:<ul>
<li>alerts: sr_subscribe <a href="../amqp_cap-xml.conf">amqp_cap.xml.conf</a> start/stop/status</li>
<li>citypage_weather: sr_subscribe <a href="../amqp_citypage.conf">amqp_citypage.conf</a> start/stop/status</li>
<li>rdps_grib: sr_subscribe <a href="../amqp_rdps-grib.conf">amqp_rdps-grib.conf</a> start/stop/status</li>
</ul>
</li>
<li>The logs are available under ~/.cache/sarra/log</li>
<li>To make a cleanup, use: sr_subscribe configname.conf cleanup</li>
</ul>
<h2 id="external-links">External links</h2>
<ul>
<li>
<p>AMQP protocol on Wikipedia:
<a href="https://en.wikipedia.org/wiki/Advanced_Message_Queuing_Protocol">https://en.wikipedia.org/wiki/Advanced_Message_Queuing_Protocol</a></p>
</li>
<li>
<p>AMQP python library: 
<a href="https://pypi.python.org/pypi/amqplib">https://pypi.python.org/pypi/amqplib</a></p>
</li>
</ul>
<h2 id="contact-us">Contact Us</h2>
<p>If you use the data available on the MSC Datamart, it is strongly recommend that you subscribe to the MSC Datamart's mailing list in order to be warned of any updates or changes regarding the data available. You can subscribe here:</p>
<p><a href="https://comm.collab.science.gc.ca/mailman3/postorius/lists/dd_info/">https://comm.collab.science.gc.ca/mailman3/postorius/lists/dd_info/</a></p>
<p>User support is provided on a best effort basis during normal business hours. Users requesting support are invited to <a href="https://www.weather.gc.ca/mainmenu/contact_us_e.html">contact us</a>.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                    <br>
                    Effectuez une recherche dans la documentation en indiquant les termes désirés ci-après.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

        <!-- Matomo -->
        <script>
            var _paq = window._paq = window._paq || [];
            /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
            _paq.push(['trackPageView']);
            _paq.push(['enableLinkTracking']);
            (function() {
            var u="https://msc-analytics.ca/piwik/";
            _paq.push(['setTrackerUrl', u+'matomo.php']);
            _paq.push(['setSiteId', '13']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
            })();
        </script>
        <!-- End Matomo Code -->
    </body>
</html>
